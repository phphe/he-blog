{"_path":"/zh/blog/forwardref-generics","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"React使用fowardRef导致丢失组件泛型","description":"React 中使用 fowardRef 包裹组件后，会丢失组件的泛型。这是个 bug。解决办法，使用修复的 fowardRef 函数类型覆盖原来的。","date":"2024-02-02 13:30","tags":["react","typescript","bug"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"React 中使用 fowardRef 包裹组件后，会丢失组件的泛型。这是个 bug。解决办法，使用修复的 fowardRef 函数类型覆盖原来的。"}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes solarized-light github-dark monokai","code":"import React from \"react\";\n\ntype FixedForwardRef = <T, P = {}>(\n  render: (props: P, ref: React.Ref<T>) => React.ReactElement | null\n) => (props: P & React.RefAttributes<T>) => React.ReactElement | null;\n\nconst forwardRef = React.forwardRef as FixedForwardRef;\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#268BD2;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" React"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#2AA198;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" \"react\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#586E75;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-weight:bold;--shiki-dark-font-weight:inherit;--shiki-sepia-font-weight:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" FixedForwardRef"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"P"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {}>(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#268BD2;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"  render"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"props"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" P"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" React"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#586E75;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-weight:bold;--shiki-dark-font-weight:inherit;--shiki-sepia-font-weight:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" React"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"ReactElement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" |"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":" null\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#586E75;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-weight:bold;--shiki-dark-font-weight:inherit;--shiki-sepia-font-weight:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"props"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" P"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" &"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" React"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"RefAttributes"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#586E75;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-weight:bold;--shiki-dark-font-weight:inherit;--shiki-sepia-font-weight:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" React"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":"ReactElement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" |"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":" null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#586E75;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-default-font-weight:bold;--shiki-dark-font-weight:inherit;--shiki-sepia-font-weight:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#268BD2;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" forwardRef"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#268BD2;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" React"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#268BD2;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"forwardRef"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#859900;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#CB4B16;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline"},"children":[{"type":"text","value":" FixedForwardRef"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":";\n"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:zh:blog:forwardRef generics.md","_source":"content","_file":"zh/blog/forwardRef generics.md","_extension":"md"}