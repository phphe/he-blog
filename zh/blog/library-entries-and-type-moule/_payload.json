[{"data":1,"prerenderedAt":530},["Reactive",2],{"content-query-JZGdsfmQHv":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"date":10,"tags":11,"excerpt":15,"body":25,"_type":525,"_id":526,"_source":527,"_file":528,"_extension":529},"/zh/blog/library-entries-and-type-moule","blog",false,"","npm库多个导出点以及type module和typescript类型定义文件","详解开发 npm 库时，package.json 里的相关字段。","2024-01-31 23:09",[12,13,14],"npm","library","frontend",{"type":16,"children":17},"root",[18],{"type":19,"tag":20,"props":21,"children":22},"element","p",{},[23],{"type":24,"value":9},"text",{"type":16,"children":26,"toc":520},[27,31,38,52,57,62,285,290,295,300,306,501,514],{"type":19,"tag":20,"props":28,"children":29},{},[30],{"type":24,"value":9},{"type":19,"tag":32,"props":33,"children":35},"h2",{"id":34},"main-module",[36],{"type":24,"value":37},"main & module",{"type":19,"tag":20,"props":39,"children":40},{},[41,43,50],{"type":24,"value":42},"以前使用 main 和 module。main 指向主要入口, 一般是 cjs 格式的。module 指向 esm 入口。注意，仅 webpack 和 rollup 等打包工具支持 module，而 nodejs 仅支持 main. 如果你直接执行 node 命令如",{"type":19,"tag":44,"props":45,"children":47},"code",{"className":46},[],[48],{"type":24,"value":49},"node your.js",{"type":24,"value":51},"，你的 js 文件引入了库，node 将只会调用库的 main 字段对应的文件。",{"type":19,"tag":32,"props":53,"children":55},{"id":54},"exports",[56],{"type":24,"value":54},{"type":19,"tag":20,"props":58,"children":59},{},[60],{"type":24,"value":61},"exports 可以导出多个入口。",{"type":19,"tag":63,"props":64,"children":68},"pre",{"className":65,"code":66,"language":67,"meta":7,"style":7},"language-json shiki shiki-themes solarized-light github-dark monokai","{\n  \"exports\": {\n    \".\": {\n      \"import\": \"./src/main-esm.js\",\n      \"require\": \"./src/main-cjs.js\",\n      \"types\": \"./src/main.d.ts\"\n    },\n    \"./module-a\": {\n      \"import\": \"./src/module-a-esm.js\",\n      \"require\": \"./src/module-a-cjs.js\",\n      \"types\": \"./src/module-a.d.ts\"\n    }\n  }\n}\n","json",[69],{"type":19,"tag":44,"props":70,"children":71},{"__ignoreMap":7},[72,84,99,112,137,159,177,186,199,220,241,258,267,276],{"type":19,"tag":73,"props":74,"children":77},"span",{"class":75,"line":76},"line",1,[78],{"type":19,"tag":73,"props":79,"children":81},{"style":80},"--shiki-default:#657B83;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[82],{"type":24,"value":83},"{\n",{"type":19,"tag":73,"props":85,"children":87},{"class":75,"line":86},2,[88,94],{"type":19,"tag":73,"props":89,"children":91},{"style":90},"--shiki-default:#859900;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[92],{"type":24,"value":93},"  \"exports\"",{"type":19,"tag":73,"props":95,"children":96},{"style":80},[97],{"type":24,"value":98},": {\n",{"type":19,"tag":73,"props":100,"children":102},{"class":75,"line":101},3,[103,108],{"type":19,"tag":73,"props":104,"children":105},{"style":90},[106],{"type":24,"value":107},"    \".\"",{"type":19,"tag":73,"props":109,"children":110},{"style":80},[111],{"type":24,"value":98},{"type":19,"tag":73,"props":113,"children":115},{"class":75,"line":114},4,[116,121,126,132],{"type":19,"tag":73,"props":117,"children":118},{"style":90},[119],{"type":24,"value":120},"      \"import\"",{"type":19,"tag":73,"props":122,"children":123},{"style":80},[124],{"type":24,"value":125},": ",{"type":19,"tag":73,"props":127,"children":129},{"style":128},"--shiki-default:#2AA198;--shiki-dark:#9ECBFF;--shiki-sepia:#CFCFC2",[130],{"type":24,"value":131},"\"./src/main-esm.js\"",{"type":19,"tag":73,"props":133,"children":134},{"style":80},[135],{"type":24,"value":136},",\n",{"type":19,"tag":73,"props":138,"children":140},{"class":75,"line":139},5,[141,146,150,155],{"type":19,"tag":73,"props":142,"children":143},{"style":90},[144],{"type":24,"value":145},"      \"require\"",{"type":19,"tag":73,"props":147,"children":148},{"style":80},[149],{"type":24,"value":125},{"type":19,"tag":73,"props":151,"children":152},{"style":128},[153],{"type":24,"value":154},"\"./src/main-cjs.js\"",{"type":19,"tag":73,"props":156,"children":157},{"style":80},[158],{"type":24,"value":136},{"type":19,"tag":73,"props":160,"children":162},{"class":75,"line":161},6,[163,168,172],{"type":19,"tag":73,"props":164,"children":165},{"style":90},[166],{"type":24,"value":167},"      \"types\"",{"type":19,"tag":73,"props":169,"children":170},{"style":80},[171],{"type":24,"value":125},{"type":19,"tag":73,"props":173,"children":174},{"style":128},[175],{"type":24,"value":176},"\"./src/main.d.ts\"\n",{"type":19,"tag":73,"props":178,"children":180},{"class":75,"line":179},7,[181],{"type":19,"tag":73,"props":182,"children":183},{"style":80},[184],{"type":24,"value":185},"    },\n",{"type":19,"tag":73,"props":187,"children":189},{"class":75,"line":188},8,[190,195],{"type":19,"tag":73,"props":191,"children":192},{"style":90},[193],{"type":24,"value":194},"    \"./module-a\"",{"type":19,"tag":73,"props":196,"children":197},{"style":80},[198],{"type":24,"value":98},{"type":19,"tag":73,"props":200,"children":202},{"class":75,"line":201},9,[203,207,211,216],{"type":19,"tag":73,"props":204,"children":205},{"style":90},[206],{"type":24,"value":120},{"type":19,"tag":73,"props":208,"children":209},{"style":80},[210],{"type":24,"value":125},{"type":19,"tag":73,"props":212,"children":213},{"style":128},[214],{"type":24,"value":215},"\"./src/module-a-esm.js\"",{"type":19,"tag":73,"props":217,"children":218},{"style":80},[219],{"type":24,"value":136},{"type":19,"tag":73,"props":221,"children":223},{"class":75,"line":222},10,[224,228,232,237],{"type":19,"tag":73,"props":225,"children":226},{"style":90},[227],{"type":24,"value":145},{"type":19,"tag":73,"props":229,"children":230},{"style":80},[231],{"type":24,"value":125},{"type":19,"tag":73,"props":233,"children":234},{"style":128},[235],{"type":24,"value":236},"\"./src/module-a-cjs.js\"",{"type":19,"tag":73,"props":238,"children":239},{"style":80},[240],{"type":24,"value":136},{"type":19,"tag":73,"props":242,"children":244},{"class":75,"line":243},11,[245,249,253],{"type":19,"tag":73,"props":246,"children":247},{"style":90},[248],{"type":24,"value":167},{"type":19,"tag":73,"props":250,"children":251},{"style":80},[252],{"type":24,"value":125},{"type":19,"tag":73,"props":254,"children":255},{"style":128},[256],{"type":24,"value":257},"\"./src/module-a.d.ts\"\n",{"type":19,"tag":73,"props":259,"children":261},{"class":75,"line":260},12,[262],{"type":19,"tag":73,"props":263,"children":264},{"style":80},[265],{"type":24,"value":266},"    }\n",{"type":19,"tag":73,"props":268,"children":270},{"class":75,"line":269},13,[271],{"type":19,"tag":73,"props":272,"children":273},{"style":80},[274],{"type":24,"value":275},"  }\n",{"type":19,"tag":73,"props":277,"children":279},{"class":75,"line":278},14,[280],{"type":19,"tag":73,"props":281,"children":282},{"style":80},[283],{"type":24,"value":284},"}\n",{"type":19,"tag":20,"props":286,"children":287},{},[288],{"type":24,"value":289},"\".\"代表主要入口，即上面的 main & module。子级的\"import\"是 esm 文件, \"require\"是 cjs 文件。\"types\"是类型定义文件。",{"type":19,"tag":20,"props":291,"children":292},{},[293],{"type":24,"value":294},"遗憾的是，\"exports\"被 nodejs 和主要打包工具支持，却不被当前稳定版本的 typescript(4.5)支持。typescript4.7 已经支持了，但是 vscode 内置的是 4.5. 所以使用 vscode 时会找不到\"exports\"里的类型定义文件。",{"type":19,"tag":20,"props":296,"children":297},{},[298],{"type":24,"value":299},"所以如果你的库有多个入口并且每个入口都有自己的类型定义文件，我建议你不要这样做，而是发布为不同的 npm 库。",{"type":19,"tag":32,"props":301,"children":303},{"id":302},"packagejson-例子",[304],{"type":24,"value":305},"package.json 例子",{"type":19,"tag":63,"props":307,"children":309},{"className":65,"code":308,"language":67,"meta":7,"style":7},"{\n  \"type\": \"module\",\n  \"main\": \"./src/index.cjs\",\n  \"module\": \"./src/index.js\",\n  \"types\": \"./src/index.d.ts\",\n  \"exports\": {\n    \".\": {\n      \"require\": \"./src/index.cjs\",\n      \"import\": \"./src/index.js\",\n      \"types\": \"./src/index.d.ts\"\n    }\n  }\n}\n",[310],{"type":19,"tag":44,"props":311,"children":312},{"__ignoreMap":7},[313,320,341,362,383,404,415,426,445,464,480,487,494],{"type":19,"tag":73,"props":314,"children":315},{"class":75,"line":76},[316],{"type":19,"tag":73,"props":317,"children":318},{"style":80},[319],{"type":24,"value":83},{"type":19,"tag":73,"props":321,"children":322},{"class":75,"line":86},[323,328,332,337],{"type":19,"tag":73,"props":324,"children":325},{"style":90},[326],{"type":24,"value":327},"  \"type\"",{"type":19,"tag":73,"props":329,"children":330},{"style":80},[331],{"type":24,"value":125},{"type":19,"tag":73,"props":333,"children":334},{"style":128},[335],{"type":24,"value":336},"\"module\"",{"type":19,"tag":73,"props":338,"children":339},{"style":80},[340],{"type":24,"value":136},{"type":19,"tag":73,"props":342,"children":343},{"class":75,"line":101},[344,349,353,358],{"type":19,"tag":73,"props":345,"children":346},{"style":90},[347],{"type":24,"value":348},"  \"main\"",{"type":19,"tag":73,"props":350,"children":351},{"style":80},[352],{"type":24,"value":125},{"type":19,"tag":73,"props":354,"children":355},{"style":128},[356],{"type":24,"value":357},"\"./src/index.cjs\"",{"type":19,"tag":73,"props":359,"children":360},{"style":80},[361],{"type":24,"value":136},{"type":19,"tag":73,"props":363,"children":364},{"class":75,"line":114},[365,370,374,379],{"type":19,"tag":73,"props":366,"children":367},{"style":90},[368],{"type":24,"value":369},"  \"module\"",{"type":19,"tag":73,"props":371,"children":372},{"style":80},[373],{"type":24,"value":125},{"type":19,"tag":73,"props":375,"children":376},{"style":128},[377],{"type":24,"value":378},"\"./src/index.js\"",{"type":19,"tag":73,"props":380,"children":381},{"style":80},[382],{"type":24,"value":136},{"type":19,"tag":73,"props":384,"children":385},{"class":75,"line":139},[386,391,395,400],{"type":19,"tag":73,"props":387,"children":388},{"style":90},[389],{"type":24,"value":390},"  \"types\"",{"type":19,"tag":73,"props":392,"children":393},{"style":80},[394],{"type":24,"value":125},{"type":19,"tag":73,"props":396,"children":397},{"style":128},[398],{"type":24,"value":399},"\"./src/index.d.ts\"",{"type":19,"tag":73,"props":401,"children":402},{"style":80},[403],{"type":24,"value":136},{"type":19,"tag":73,"props":405,"children":406},{"class":75,"line":161},[407,411],{"type":19,"tag":73,"props":408,"children":409},{"style":90},[410],{"type":24,"value":93},{"type":19,"tag":73,"props":412,"children":413},{"style":80},[414],{"type":24,"value":98},{"type":19,"tag":73,"props":416,"children":417},{"class":75,"line":179},[418,422],{"type":19,"tag":73,"props":419,"children":420},{"style":90},[421],{"type":24,"value":107},{"type":19,"tag":73,"props":423,"children":424},{"style":80},[425],{"type":24,"value":98},{"type":19,"tag":73,"props":427,"children":428},{"class":75,"line":188},[429,433,437,441],{"type":19,"tag":73,"props":430,"children":431},{"style":90},[432],{"type":24,"value":145},{"type":19,"tag":73,"props":434,"children":435},{"style":80},[436],{"type":24,"value":125},{"type":19,"tag":73,"props":438,"children":439},{"style":128},[440],{"type":24,"value":357},{"type":19,"tag":73,"props":442,"children":443},{"style":80},[444],{"type":24,"value":136},{"type":19,"tag":73,"props":446,"children":447},{"class":75,"line":201},[448,452,456,460],{"type":19,"tag":73,"props":449,"children":450},{"style":90},[451],{"type":24,"value":120},{"type":19,"tag":73,"props":453,"children":454},{"style":80},[455],{"type":24,"value":125},{"type":19,"tag":73,"props":457,"children":458},{"style":128},[459],{"type":24,"value":378},{"type":19,"tag":73,"props":461,"children":462},{"style":80},[463],{"type":24,"value":136},{"type":19,"tag":73,"props":465,"children":466},{"class":75,"line":222},[467,471,475],{"type":19,"tag":73,"props":468,"children":469},{"style":90},[470],{"type":24,"value":167},{"type":19,"tag":73,"props":472,"children":473},{"style":80},[474],{"type":24,"value":125},{"type":19,"tag":73,"props":476,"children":477},{"style":128},[478],{"type":24,"value":479},"\"./src/index.d.ts\"\n",{"type":19,"tag":73,"props":481,"children":482},{"class":75,"line":243},[483],{"type":19,"tag":73,"props":484,"children":485},{"style":80},[486],{"type":24,"value":266},{"type":19,"tag":73,"props":488,"children":489},{"class":75,"line":260},[490],{"type":19,"tag":73,"props":491,"children":492},{"style":80},[493],{"type":24,"value":275},{"type":19,"tag":73,"props":495,"children":496},{"class":75,"line":269},[497],{"type":19,"tag":73,"props":498,"children":499},{"style":80},[500],{"type":24,"value":284},{"type":19,"tag":20,"props":502,"children":503},{},[504,506,512],{"type":24,"value":505},"因为使用了",{"type":19,"tag":44,"props":507,"children":509},{"className":508},[],[510],{"type":24,"value":511},"\"type\": \"module\"",{"type":24,"value":513},", 所以导出的 cjs 文件用'cjs'扩展名。",{"type":19,"tag":515,"props":516,"children":517},"style",{},[518],{"type":24,"value":519},"html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":7,"searchDepth":86,"depth":86,"links":521},[522,523,524],{"id":34,"depth":86,"text":37},{"id":54,"depth":86,"text":54},{"id":302,"depth":86,"text":305},"markdown","content:zh:blog:library entries and type moule.md","content","zh/blog/library entries and type moule.md","md",1706852440120]